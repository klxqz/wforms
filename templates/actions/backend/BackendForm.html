<script type="text/javascript" src="{$wa_url}wa-content/js/jquery-plugins/jquery.tmpl.min.js"></script>

<h1>Редактирование формы</h1>

<form id="edit-form" method="post" action="?action=saveForm" enctype="multipart/form-data" >
    <div class="fields form s-dialog-form">
        <input type="hidden" id="form-id" value="{$form.id}" name="form[id]">

        <div class="field-group">
            <div class="field">
                <div class="name">[`Title`]</div>
                <div class="value">
                    <input type="text" value="{$form.title|escape}" class="large long" name="form[title]">
                </div>
            </div>
        </div>
        <div class="field-group">
            <div class="field">
                <div class="name">[`Enabled`]</div>
                <div class="value">
                    <input type="hidden"  value="0" name="form[enabled]">
                    <input type="checkbox" {if $form.enabled}checked="checked"{/if} value="1" name="form[enabled]">
                </div>
            </div>
        </div>
        <div class="field-group" style="min-width: 600px;">
            <div class="field description">
                <div class="name">
                    <label for="description">
                        [`Description`]
                    </label>
                </div>
                <div class="value">
                    <i class="icon16 loading"></i>
                    <div class="s-editor-core-wrapper wa-editor-core-wrapper" style="display:none;">
                        <ul class="wa-editor-wysiwyg-html-toggle s-wysiwyg-html-toggle">
                            <li class="selected"><a class="wysiwyg" href="#">[s`WYSIWYG`]</a></li>
                            <li><a class="html" href="#">HTML</a></li>
                        </ul>
                        <div>
                            <textarea style="display:none" id="messagebox-description-content" name="form[description]">{$form.description|escape}</textarea>
                            <div class="ace">
                                <div id="wa-ace-editor-container"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div> 
        </div>

        <div class="field-group">
            <div class="field">
                <div class="name">[`Form fields`]</div>
                <div class="value">
                    <table id="form-fiels-table" class="zebra full-width">
                        <thead>
                            <tr class="header">
                                <th class="min-width">&nbsp;</th>
                                <th>Название</th>
                                <th>Подсказка</th>
                                <th>Тип и значения</th>
                                <th>Обязательное</th>
                                <th colspan="2">&nbsp;</th>
                            </tr>
                        </thead>

                        <tbody style="vertical-align: top !important;">
                            {foreach $fields as $field}
                                <tr class="field-row" data-id="{$field.id}">
                                    <td></td>
                                    <td>
                                        {$field.name|escape}
                                    </td>
                                    <td>
                                        {$field.hint|escape}
                                    </td>
                                    <td>
                                        {$field_types[$field.type]}
                                    </td>
                                    <td>
                                        {if $field.required}
                                            [`Yes`]
                                        {else}
                                            [`No`]
                                        {/if}
                                    </td>
                                    <td>
                                        <div class="control-buttons">
                                            <a href="#" class="edit-but"><i class="icon16 edit"></i>Редактировать</a>
                                            <a href="#" class="delete-but"><i class="icon16 cross"></i>Удалить</a>
                                        </div>
                                    </td>
                                </tr>
                            {/foreach}



                        </tbody>
                    </table>

                    <a href="#" id="add-field-but"><i class="icon16 add"></i>Добавить</a>
                </div>
            </div>
        </div>

        <div class="field">
            <div class="value submit">
                <input type="submit" class="button green" value="[`Save`]">
                <span class="response"></span>
            </div>
        </div>
    </div>
</form>

{literal}
    <script id="field-tmpl" type="text/x-jquery-tmpl">
        <tr class="field-row">
            <td></td>
            <td>
                ${name}
            </td>
            <td>
                ${hint}
            </td>
            <td>
                ${type}
            </td>
            <td>
                ${required}
            </td>
            <td>
                <div class="control-buttons">
                    <a href="#" class="edit-but"><i class="icon16 edit"></i>Редактировать</a>
                    <a href="#" class="delete-but"><i class="icon16 cross"></i>Удалить</a>
                </div>
            </td>
        </tr>
    </script>
    <script id="add-edit-field-tmpl" type="text/x-jquery-tmpl">
        <tr class="field-row add-edit-field">
            <td></td>
            <td>
                <input type="hidden" value="${id}" name="field[id]" />
                <input type="text" value="${name}" name="field[name]" />
            </td>
            <td>
                <input type="text" value="${hint}" name="field[hint]" />
            </td>
            <td>
                <select name="field[type]">
                    {{each field_types}}
                    <option {{if required}}selected="selected"{{/if}} value="${$index}">${$value}</option>
                    {{/each}}
                </select>
            </td>
            <td>
                <input type="hidden" value="0" name="field[required]" />
                <input type="checkbox" {{if required}}checked="checked"{{/if}} value="1" name="field[required]" />
            </td>
            <td>
                <div class="control-buttons">
                    <a class="save-field-but js-action" href="#/saveField/"><i class="icon16 yes"></i>Сохранить</a>
                    <a class="cancel-field-but" href="#"><i class="icon16 no"></i>Отменить</a>
                </div>
            </td>
        </tr>
    </script>
{/literal}
<script type="text/javascript">
    var $field_types = $.parseJSON('{json_encode($field_types)}');
</script>